<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OrderSlip Chart Maker</title>

<style>
body{
  font-family:Arial;
  max-width:1200px;
  margin:auto;
  padding:20px;
}

input,select,button{
  padding:5px;
  margin:3px;
}

.canvas-wrap{
  position:relative;
  border:2px solid #ccc;
  display:inline-block;
  max-width:100%;
}

#mainImage{
  display:block;
  max-width:100%;
}

#boxLayer{
  position:absolute;
  top:0;
  left:0;
}

.box{
  position:absolute;
  border:2px solid red;
  background:rgba(255,0,0,0.15);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  overflow:hidden;
}

#itemList{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
  margin-top:20px;
}

.card{
  background:#fff;
  padding:10px;
  border-radius:8px;
  box-shadow:0 3px 8px rgba(0,0,0,.1);
  font-size:12px;
}

textarea{
  width:100%;
  margin-top:10px;
}
</style>
</head>

<body>

<h2>Chart Maker (Object Structure)</h2>

Chart Name:
<input id="chartName" value="Sample Chart">

Prefix:
<input id="prefix" style="width:80px">

<br>

Auto:
<input type="checkbox" id="autoNumber" checked>
Start:
<input type="number" id="startNumber" value="401">
Step:
<input type="number" id="stepNumber" value="1">

<hr>

Page:
<select id="pageSelect"></select>
Image URL:
<input id="imgUrl">
<button onclick="addPage()">Add Page</button>

<hr>

<div class="canvas-wrap">
  <img id="mainImage">
  <div id="boxLayer"></div>
</div>

<hr>

<h3>Items</h3>
<div id="itemList"></div>

<hr>

<textarea id="jsonOutput" rows="12"></textarea>

<script>

let chart={
  name:"Sample Chart",
  pages:[],
  items:{}
};

let currentPage=1;
let nextNumber=401;
let drawData=null;

const img=document.getElementById("mainImage");
const boxLayer=document.getElementById("boxLayer");

/* ---------- PAGE ---------- */

function addPage(){
  const id=chart.pages.length+1;
  const image=document.getElementById("imgUrl").value;
  if(!image) return alert("Enter image URL");

  chart.pages.push({id,image});
  updatePageSelect();
  selectPage(id);
  updateJSON();
}

function updatePageSelect(){
  const sel=document.getElementById("pageSelect");
  sel.innerHTML="";
  chart.pages.forEach(p=>{
    const o=document.createElement("option");
    o.value=p.id;
    o.text="Page "+p.id;
    sel.appendChild(o);
  });
}

document.getElementById("pageSelect").onchange=function(){
  selectPage(parseInt(this.value));
};

function selectPage(id){
  currentPage=id;
  const page=chart.pages.find(p=>p.id==id);
  img.src=page.image;
  renderBoxes();
}

img.onload=function(){
  boxLayer.style.width=img.clientWidth+"px";
  boxLayer.style.height=img.clientHeight+"px";
  renderBoxes();
};

/* ---------- DRAW ---------- */

let startX,startY,drawing=false;

boxLayer.addEventListener("mousedown",function(e){

  if(!img.src) return;

  const rect=boxLayer.getBoundingClientRect();
  startX=e.clientX-rect.left;
  startY=e.clientY-rect.top;

  const temp=document.createElement("div");
  temp.className="box";
  temp.style.left=startX+"px";
  temp.style.top=startY+"px";
  boxLayer.appendChild(temp);

  drawing=true;

  function move(ev){
    if(!drawing)return;

    let w=ev.clientX-rect.left-startX;
    let h=ev.clientY-rect.top-startY;

    if(startX+w>boxLayer.clientWidth)
      w=boxLayer.clientWidth-startX;
    if(startY+h>boxLayer.clientHeight)
      h=boxLayer.clientHeight-startY;

    temp.style.width=w+"px";
    temp.style.height=h+"px";
  }

  function stop(){
    drawing=false;
    document.removeEventListener("mousemove",move);
    document.removeEventListener("mouseup",stop);

    const w=parseFloat(temp.style.width);
    const h=parseFloat(temp.style.height);
    if(w<5||h<5){ temp.remove(); return;}

    const scale=img.naturalWidth/img.clientWidth;

    drawData={
      page:currentPage,
      x:parseFloat(temp.style.left)*scale,
      y:parseFloat(temp.style.top)*scale,
      w:w*scale,
      h:h*scale,
      color:""
    };

    temp.remove();

    let number;
    if(autoNumber.checked){
      number=getNextAutoNumber();
    }else{
      number=prompt("Enter number:");
    }

    if(!number) return;

    if(chart.items[number]){
      alert("Duplicate number");
      return;
    }

    chart.items[number]=drawData;

    updateJSON();
    renderBoxes();
  }

  document.addEventListener("mousemove",move);
  document.addEventListener("mouseup",stop);
});

/* ---------- AUTO NUMBER ---------- */

function getNextAutoNumber(){
  let num=parseInt(document.getElementById("startNumber").value)||1;
  const step=parseInt(document.getElementById("stepNumber").value)||1;

  while(chart.items[num]){
    num+=step;
  }

  return num;
}

/* ---------- RENDER ---------- */

function renderBoxes(){

  boxLayer.innerHTML="";

  if(!img.naturalWidth) return;

  const scale=img.clientWidth/img.naturalWidth;

  Object.keys(chart.items).forEach(num=>{

    const item=chart.items[num];
    if(item.page!=currentPage) return;

    const div=document.createElement("div");
    div.className="box";

    div.style.left=item.x*scale+"px";
    div.style.top=item.y*scale+"px";
    div.style.width=item.w*scale+"px";
    div.style.height=item.h*scale+"px";

    div.textContent=(prefix.value||"")+num;
    div.style.fontSize=Math.max(12,(item.w*scale)/4)+"px";

    boxLayer.appendChild(div);
  });

  renderList();
}

/* ---------- LIST ---------- */

function renderList(){

  const list=document.getElementById("itemList");
  list.innerHTML="";

  Object.keys(chart.items).forEach(num=>{

    const item=chart.items[num];

    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
    <b>${num}</b><br>
    Page:<input value="${item.page}"><br>
    X:<input value="${item.x}"><br>
    Y:<input value="${item.y}"><br>
    W:<input value="${item.w}"><br>
    H:<input value="${item.h}"><br>
    Color:<input value="${item.color}"><br>
    <button>Delete</button>
    `;

    const inputs=card.querySelectorAll("input");

    inputs.forEach((inp,i)=>{
      inp.oninput=function(){
        if(i==0) item.page=parseInt(this.value);
        if(i==1) item.x=parseFloat(this.value);
        if(i==2) item.y=parseFloat(this.value);
        if(i==3) item.w=parseFloat(this.value);
        if(i==4) item.h=parseFloat(this.value);
        if(i==5) item.color=this.value;
        renderBoxes();
        updateJSON();
      };
    });

    card.querySelector("button").onclick=function(){
      delete chart.items[num];
      renderBoxes();
      updateJSON();
    };

    list.appendChild(card);
  });
}

/* ---------- JSON ---------- */

function updateJSON(){
  chart.name=document.getElementById("chartName").value;
  jsonOutput.value=JSON.stringify(chart,null,2);
}

</script>
</body>
</html>